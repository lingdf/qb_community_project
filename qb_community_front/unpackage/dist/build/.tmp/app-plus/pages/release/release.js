(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/release/release"],{"27e1":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i("a34a"));function s(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return u(t)||o(t,e)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,e){var i=[],n=!0,s=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0)if(i.push(r.value),e&&i.length===e)break}catch(u){s=!0,a=u}finally{try{n||null==o["return"]||o["return"]()}finally{if(s)throw a}}return i}function u(t){if(Array.isArray(t))return t}function c(t,e,i,n,s,a,r){try{var o=t[a](r),u=o.value}catch(c){return void i(c)}o.done?e(u):Promise.resolve(u).then(n,s)}function l(t){return function(){var e=this,i=arguments;return new Promise(function(n,s){var a=t.apply(e,i);function r(t){c(a,n,s,r,o,"next",t)}function o(t){c(a,n,s,r,o,"throw",t)}r(void 0)})}}var p=function(){return i.e("components/uni-nav-bar/uni-nav-bar").then(i.bind(null,"f3cd"))},f=function(){return i.e("components/common/upload-images").then(i.bind(null,"54f2"))},h=function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"ea64"))},d={components:{uniNavBar:p,uploadImages:f,uniPopup:h},data:function(){return{flag:!1,articleStatus:"所有人可见",itemList:["仅自己可见","所有人可见"],title:"",nuiTextarea:"",isopen:0,imgList:[],imgIds:[],showPopup:!0,postClass:{id:0,title:"",range:[],list:[]},topic:{id:0,title:""}}},onBackPress:function(){if(this.nuiTextarea||!(this.imgList.length<1))return this.flag?void 0:(this.saveInner(),!0)},onLoad:function(e){var i=this,n=t.getStorageSync("tempArticle");n&&(n=JSON.parse(n),this.articleStatus=this.itemList[n.isopen]||"所有人可见",this.imgIds=n.imgIds,this.imgIds.length&&(this.imgList=n.imgList),this.title=n.title,this.nuiTextarea=n.nuiTextarea,n.postClass&&(this.postClass=n.postClass),n.topic&&(this.topic=n.topic));var s=!!e.postClass&&JSON.parse(e.postClass);this.getPostClass(s),t.$on("changeTopic",function(t){i.topic.id=t.id,i.topic.title=t.title})},methods:{back:function(){t.navigateBack({delta:1})},release:function(){var e=l(n.default.mark(function e(){var i,s,r,o,u;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.postClass.id){e.next=4;break}return e.abrupt("return",t.showToast({title:"请选择文章分类",icon:"none"}));case 4:return t.showLoading({title:"发布中...",mask:!0}),e.next=7,this.$http.post("user/create",{user_id:this.User.userinfo.id,title:this.title,text:this.nuiTextarea,openType:this.isopen,topic_id:this.topic.id,path:this.User.userinfo.userinfo.path||"中国",post_class_id:this.postClass.id,imglist_id:JSON.stringify(this.imgIds)});case 7:i=e.sent,s=a(i,2),r=s[0],o=s[1],r?(t.showToast({title:"发布失败~",icon:"none"}),t.hideLoading()):(u=o.data,200==u.code?(t.showToast({title:"发布成功~",icon:"none"}),this.flag=!0,t.hideLoading(),t.navigateBack({delta:1})):(t.showToast({title:"发布失败~",icon:"none"}),t.hideLoading()));case 12:case"end":return e.stop()}},e,this)}));function i(){return e.apply(this,arguments)}return i}(),postStatus:function(){var e=this;t.showActionSheet({itemList:this.itemList,success:function(t){e.articleStatus=e.itemList[t.tapIndex]}})},saveInner:function(){var e=this;t.showModal({content:"是否保存为草稿",cancelText:"不保存",confirmText:"保存",success:function(i){if(i.confirm){var n={isopen:e.itemList.indexOf(e.articleStatus),title:e.title,nuiTextarea:e.nuiTextarea,imgList:e.imgList,imgIds:e.imgIds,postClass:e.postClass,topic:e.topic};t.setStorageSync("tempArticle",JSON.stringify(n))}else t.removeStorage({key:"tempArticle"});e.flag=!0,t.navigateBack({delta:1})}})},upload:function(t){var e=JSON.parse(t);this.imgList.push(e.url),this.imgIds.push({id:e.id})},delImageList:function(t){this.imgList.splice(t,1),this.imgIds.splice(t,1)},hidePopup:function(){this.showPopup=!1},getPostClass:function(){var e=l(n.default.mark(function e(i){var s,r,o,u,c,l,p,f,h,d,v,m,g,b,x,w;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!i){e.next=23;break}for(this.postClass.list=i,s=!0,r=!1,o=void 0,e.prev=5,u=i[Symbol.iterator]();!(s=(c=u.next()).done);s=!0)l=c.value,this.postClass.range.push(l.name);e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](5),r=!0,o=e.t0;case 13:e.prev=13,e.prev=14,s||null==u.return||u.return();case 16:if(e.prev=16,!r){e.next=19;break}throw o;case 19:return e.finish(16);case 20:return e.finish(13);case 21:e.next=54;break;case 23:return e.next=25,this.$http.get("index/getClass");case 25:if(p=e.sent,f=a(p,2),h=f[0],d=f[1],h&&t.showToast({title:"网络开小差了",icon:"none"}),v=d.data,200!=v.code||!v.data){e.next=53;break}for(m=!0,g=!1,b=void 0,e.prev=35,x=v.data.list[Symbol.iterator]();!(m=(w=x.next()).done);m=!0)l=w.value,this.postClass.range.push(l.classname),this.postClass.list.push({id:l.id,name:l.classname});e.next=43;break;case 39:e.prev=39,e.t1=e["catch"](35),g=!0,b=e.t1;case 43:e.prev=43,e.prev=44,m||null==x.return||x.return();case 46:if(e.prev=46,!g){e.next=49;break}throw b;case 49:return e.finish(46);case 50:return e.finish(43);case 51:e.next=54;break;case 53:t.showToast({title:"网络错误",icon:"none"});case 54:case"end":return e.stop()}},e,this,[[5,9,13,21],[14,,16,20],[35,39,43,51],[44,,46,50]])}));function i(t){return e.apply(this,arguments)}return i}(),changePostClass:function(t){this.postClass.id=this.postClass.list[t.target.value].id,this.postClass.title=this.postClass.list[t.target.value].name},changeTopic:function(){t.navigateTo({url:"../topic-nav/topic-nav?isChange="+!0})}}};e.default=d}).call(this,i("6e42")["default"])},"841b":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},s=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return s})},"84ee":function(t,e,i){"use strict";(function(t){i("78d4"),i("921b");n(i("66fd"));var e=n(i("febf"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])},"8c47":function(t,e,i){},bd17:function(t,e,i){"use strict";var n=i("8c47"),s=i.n(n);s.a},e6fe:function(t,e,i){"use strict";i.r(e);var n=i("27e1"),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=s.a},febf:function(t,e,i){"use strict";i.r(e);var n=i("841b"),s=i("e6fe");for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);i("bd17");var r=i("2877"),o=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,null,null);e["default"]=o.exports}},[["84ee","common/runtime","common/vendor"]]]);